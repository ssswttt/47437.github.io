<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学生学情调查</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=" type="image/x-icon">
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5', // 主色调：靛蓝色，代表智慧和信任
                        secondary: '#EC4899', // 辅助色：粉色，增加活力
                        neutral: '#F3F4F6', // 中性色：浅灰，用于背景
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .scale-transition {
                transition: transform 0.3s ease, opacity 0.3s ease;
            }
            .card-hover {
                @apply hover:shadow-lg hover:-translate-y-1 transition-all duration-300;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-purple-50 min-h-screen font-sans">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- 进度指示器 -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div class="flex flex-col items-center">
                    <div id="step1-indicator" class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center font-bold">1</div>
                    <span class="text-sm mt-2 text-primary font-medium">学习情况</span>
                </div>
                <div class="flex-1 mx-4 h-1 bg-gray-200">
                    <div id="progress-1-2" class="h-full bg-primary w-0 transition-all duration-500"></div>
                </div>
                <div class="flex flex-col items-center">
                    <div id="step2-indicator" class="w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold">2</div>
                    <span class="text-sm mt-2 text-gray-500">数学学习爱好</span>
                </div>
                <div class="flex-1 mx-4 h-1 bg-gray-200">
                    <div id="progress-2-3" class="h-full bg-primary w-0 transition-all duration-500"></div>
                </div>
                <div class="flex flex-col items-center">
                    <div id="step3-indicator" class="w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center font-bold">3</div>
                    <span class="text-sm mt-2 text-gray-500">结果分析</span>
                </div>
            </div>
        </div>

        <!-- 欢迎界面 -->
        <div id="welcome-screen" class="bg-white rounded-2xl shadow-md p-8 text-center mb-8 transform transition-all duration-500">
            <div class="w-20 h-20 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fa fa-calculator text-4xl text-primary"></i>
            </div>
            <h1 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold text-gray-800 mb-4">欢迎来到数学乐园！</h1>
            <p class="text-gray-600 mb-8 max-w-lg mx-auto">为了给你提供更个性化的数学学习体验，请完成以下简单的小调查，帮助我们了解你的学习情况和数学兴趣吧！</p>
            <button id="start-survey" class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-8 rounded-full shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                开始调查 <i class="fa fa-arrow-right ml-2"></i>
            </button>
        </div>

        <!-- 学习情况自评量表 -->
        <div id="learning-survey" class="hidden bg-white rounded-2xl shadow-md p-6 md:p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fa fa-book text-primary mr-3"></i> 学习情况小调查
            </h2>
            <p class="text-gray-600 mb-6">下面是一些关于你学习情况的描述，请根据你的实际情况选择最符合的选项吧！</p>
            
            <form id="learning-form" class="space-y-6">
                <!-- 内部动机 -->
                <div class="bg-neutral rounded-xl p-5">
                    <h3 class="font-semibold text-gray-800 mb-4">一、对学习的感觉</h3>
                    
                    <div class="question mb-5">
                        <p class="text-gray-700 mb-3 font-medium">1. 不用老师或家长提醒，我也会主动学自己感兴趣的知识点</p>
                        <div class="flex flex-wrap gap-2">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q1" value="1" class="mr-2 accent-primary"> 完全不符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q1" value="2" class="mr-2 accent-primary"> 不太符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q1" value="3" class="mr-2 accent-primary"> 一般
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q1" value="4" class="mr-2 accent-primary"> 比较符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q1" value="5" class="mr-2 accent-primary"> 完全符合
                            </label>
                        </div>
                    </div>
                    
                    <div class="question mb-5">
                        <p class="text-gray-700 mb-3 font-medium">2. 上课学到新内容时，我会觉得"哇，这个好有趣"</p>
                        <div class="flex flex-wrap gap-2">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q2" value="1" class="mr-2 accent-primary"> 完全不符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q2" value="2" class="mr-2 accent-primary"> 不太符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q2" value="3" class="mr-2 accent-primary"> 一般
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q2" value="4" class="mr-2 accent-primary"> 比较符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q2" value="5" class="mr-2 accent-primary"> 完全符合
                            </label>
                        </div>
                    </div>
                    
                    <div class="question mb-5">
                        <p class="text-gray-700 mb-3 font-medium">3. 就算没有奖励，我也愿意花时间研究不懂的问题</p>
                        <div class="flex flex-wrap gap-2">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q3" value="1" class="mr-2 accent-primary"> 完全不符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q3" value="2" class="mr-2 accent-primary"> 不太符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q3" value="3" class="mr-2 accent-primary"> 一般
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q3" value="4" class="mr-2 accent-primary"> 比较符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q3" value="5" class="mr-2 accent-primary"> 完全符合
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- 外部动机 -->
                <div class="bg-neutral rounded-xl p-5">
                    <h3 class="font-semibold text-gray-800 mb-4">二、学习的动力</h3>
                    
                    <div class="question mb-5">
                        <p class="text-gray-700 mb-3 font-medium">4. 我学习主要是为了得到老师或爸妈的表扬</p>
                        <div class="flex flex-wrap gap-2">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q4" value="1" class="mr-2 accent-primary"> 完全不符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q4" value="2" class="mr-2 accent-primary"> 不太符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q4" value="3" class="mr-2 accent-primary"> 一般
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q4" value="4" class="mr-2 accent-primary"> 比较符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q4" value="5" class="mr-2 accent-primary"> 完全符合
                            </label>
                        </div>
                    </div>
                    
                    <div class="question mb-5">
                        <p class="text-gray-700 mb-3 font-medium">5. 看到同学成绩比我好时，我会想"我也要努力赶上"</p>
                        <div class="flex flex-wrap gap-2">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q5" value="1" class="mr-2 accent-primary"> 完全不符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q5" value="2" class="mr-2 accent-primary"> 不太符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q5" value="3" class="mr-2 accent-primary"> 一般
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q5" value="4" class="mr-2 accent-primary"> 比较符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q5" value="5" class="mr-2 accent-primary"> 完全符合
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- 学习策略 -->
                <div class="bg-neutral rounded-xl p-5">
                    <h3 class="font-semibold text-gray-800 mb-4">三、学习小妙招</h3>
                    
                    <div class="question mb-5">
                        <p class="text-gray-700 mb-3 font-medium">6. 我会用笔记、思维导图或小口诀帮助自己记知识点</p>
                        <div class="flex flex-wrap gap-2">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q6" value="1" class="mr-2 accent-primary"> 完全不符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q6" value="2" class="mr-2 accent-primary"> 不太符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q6" value="3" class="mr-2 accent-primary"> 一般
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q6" value="4" class="mr-2 accent-primary"> 比较符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q6" value="5" class="mr-2 accent-primary"> 完全符合
                            </label>
                        </div>
                    </div>
                    
                    <div class="question mb-5">
                        <p class="text-gray-700 mb-3 font-medium">7. 上完课后，我会花时间复习当天学的内容</p>
                        <div class="flex flex-wrap gap-2">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q7" value="1" class="mr-2 accent-primary"> 完全不符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q7" value="2" class="mr-2 accent-primary"> 不太符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q7" value="3" class="mr-2 accent-primary"> 一般
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q7" value="4" class="mr-2 accent-primary"> 比较符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q7" value="5" class="mr-2 accent-primary"> 完全符合
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- 时间管理 -->
                <div class="bg-neutral rounded-xl p-5">
                    <h3 class="font-semibold text-gray-800 mb-4">四、时间小管家</h3>
                    
                    <div class="question mb-5">
                        <p class="text-gray-700 mb-3 font-medium">8. 每天我会留固定的时间用来写作业和学习</p>
                        <div class="flex flex-wrap gap-2">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q8" value="1" class="mr-2 accent-primary"> 完全不符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q8" value="2" class="mr-2 accent-primary"> 不太符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q8" value="3" class="mr-2 accent-primary"> 一般
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q8" value="4" class="mr-2 accent-primary"> 比较符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q8" value="5" class="mr-2 accent-primary"> 完全符合
                            </label>
                        </div>
                    </div>
                    
                    <div class="question mb-5">
                        <p class="text-gray-700 mb-3 font-medium">9. 写作业时，我能专心做事，不容易被手机或电视分心</p>
                        <div class="flex flex-wrap gap-2">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q9" value="1" class="mr-2 accent-primary"> 完全不符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q9" value="2" class="mr-2 accent-primary"> 不太符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q9" value="3" class="mr-2 accent-primary"> 一般
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q9" value="4" class="mr-2 accent-primary"> 比较符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q9" value="5" class="mr-2 accent-primary"> 完全符合
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- 自我效能感 -->
                <div class="bg-neutral rounded-xl p-5">
                    <h3 class="font-semibold text-gray-800 mb-4">五、我的小信心</h3>
                    
                    <div class="question mb-5">
                        <p class="text-gray-700 mb-3 font-medium">10. 即使作业很多，我也觉得自己能按时完成</p>
                        <div class="flex flex-wrap gap-2">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q10" value="1" class="mr-2 accent-primary"> 完全不符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q10" value="2" class="mr-2 accent-primary"> 不太符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q10" value="3" class="mr-2 accent-primary"> 一般
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q10" value="4" class="mr-2 accent-primary"> 比较符合
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-primary/5 transition-colors">
                                <input type="radio" name="q10" value="5" class="mr-2 accent-primary"> 完全符合
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end mt-8">
                    <button type="button" id="to-hobby-survey" class="bg-primary hover:bg-primary/90 text-white font-medium py-3 px-8 rounded-full shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                        下一步 <i class="fa fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </form>
        </div>

        <!-- 数学学习爱好自评量表 -->
        <div id="hobby-survey" class="hidden bg-white rounded-2xl shadow-md p-6 md:p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fa fa-star text-secondary mr-3"></i> 数学学习爱好小调查
            </h2>
            <p class="text-gray-600 mb-6">每个人都有自己喜欢的数学学习方式和感兴趣的内容，告诉我们你的喜好吧！</p>
            
            <form id="hobby-form" class="space-y-6">
                <!-- 数学兴趣领域 -->
                <div class="bg-neutral rounded-xl p-5">
                    <h3 class="font-semibold text-gray-800 mb-4">一、感兴趣的数学内容</h3>
                    
                    <div class="question mb-5">
                        <p class="text-gray-700 mb-3 font-medium">1. 你对初中数学的哪些内容最感兴趣？（可多选）</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="checkbox" name="math-areas" value="代数与方程" class="mr-2 accent-secondary"> 代数与方程
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="checkbox" name="math-areas" value="几何图形" class="mr-2 accent-secondary"> 几何图形
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="checkbox" name="math-areas" value="统计与概率" class="mr-2 accent-secondary"> 统计与概率
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="checkbox" name="math-areas" value="应用题" class="mr-2 accent-secondary"> 应用题
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="checkbox" name="math-areas" value="函数" class="mr-2 accent-secondary"> 函数
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="checkbox" name="math-areas" value="数学游戏与谜题" class="mr-2 accent-secondary"> 数学游戏与谜题
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="checkbox" name="math-areas" value="生活中的数学" class="mr-2 accent-secondary"> 生活中的数学
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="checkbox" name="math-areas" value="数学史故事" class="mr-2 accent-secondary"> 数学史故事
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- 数学学习方式偏好 -->
                <div class="bg-neutral rounded-xl p-5">
                    <h3 class="font-semibold text-gray-800 mb-4">二、喜欢的数学学习方式</h3>
                    
                    <div class="question mb-5">
                        <p class="text-gray-700 mb-3 font-medium">2. 你更喜欢哪种数学学习方式？</p>
                        <div class="flex flex-wrap gap-2">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="radio" name="learning-style" value="独自解题" class="mr-2 accent-secondary"> 独自解题
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="radio" name="learning-style" value="小组讨论" class="mr-2 accent-secondary"> 小组讨论解题
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="radio" name="learning-style" value="看视频学习" class="mr-2 accent-secondary"> 看视频学习
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="radio" name="learning-style" value="动手实践" class="mr-2 accent-secondary"> 动手实践（测量、模型等）
                            </label>
                        </div>
                    </div>
                    
                    <div class="question mb-5">
                        <p class="text-gray-700 mb-3 font-medium">3. 学习数学时，你觉得哪种方式效率最高？</p>
                        <div class="flex flex-wrap gap-2">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="radio" name="efficient-way" value="多做习题" class="mr-2 accent-secondary"> 多做习题
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="radio" name="efficient-way" value="理解概念" class="mr-2 accent-secondary"> 深入理解概念
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="radio" name="efficient-way" value="总结方法" class="mr-2 accent-secondary"> 总结解题方法
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="radio" name="efficient-way" value="实际应用" class="mr-2 accent-secondary"> 联系实际应用
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- 数学学习习惯 -->
                <div class="bg-neutral rounded-xl p-5">
                    <h3 class="font-semibold text-gray-800 mb-4">三、数学学习习惯</h3>
                    
                    <div class="question mb-5">
                        <p class="text-gray-700 mb-3 font-medium">4. 遇到数学难题时，你通常会？</p>
                        <div class="flex flex-wrap gap-2">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="radio" name="difficulty-handle" value="自己钻研" class="mr-2 accent-secondary"> 自己钻研直到解决
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="radio" name="difficulty-handle" value="请教他人" class="mr-2 accent-secondary"> 请教老师或同学
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="radio" name="difficulty-handle" value="查找资料" class="mr-2 accent-secondary"> 查找资料和例题
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="radio" name="difficulty-handle" value="暂时跳过" class="mr-2 accent-secondary"> 暂时跳过，之后再做
                            </label>
                        </div>
                    </div>
                    
                    <div class="question mb-5">
                        <p class="text-gray-700 mb-3 font-medium">5. 你喜欢通过哪些方式练习数学？（可多选）</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="checkbox" name="math-practices" value="课本习题" class="mr-2 accent-secondary"> 课本习题
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="checkbox" name="math-practices" value="数学游戏" class="mr-2 accent-secondary"> 数学游戏
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="checkbox" name="math-practices" value="实际问题" class="mr-2 accent-secondary"> 解决实际问题
                            </label>
                            <label class="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-secondary/5 transition-colors">
                                <input type="checkbox" name="math-practices" value="竞赛题目" class="mr-2 accent-secondary"> 竞赛类题目
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- 开放问题 -->
                <div class="bg-neutral rounded-xl p-5">
                    <h3 class="font-semibold text-gray-800 mb-4">四、你的数学学习想法</h3>
                    
                    <div class="question mb-5">
                        <p class="text-gray-700 mb-3 font-medium">6. 你希望在数学学习中获得哪些帮助？</p>
                        <textarea name="wish" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-secondary/50 focus:border-secondary transition-colors" placeholder="比如：希望多一些几何题的解题技巧..."></textarea>
                    </div>
                </div>
                <div class="flex justify-between mt-8">
                    <!-- 上一步按钮：返回学习情况调查 -->
                    <button type="button" id="back-to-learning" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-3 px-8 rounded-full shadow-md hover:shadow-lg transition-all duration-300">
                        <i class="fa fa-arrow-left mr-2"></i> 上一步
                    </button>
                    <!-- 提交按钮：进入学情分析 -->
                    <button type="button" id="submit-survey" class="bg-secondary hover:bg-secondary/90 text-white font-medium py-3 px-8 rounded-full shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                        提交调查 <i class="fa fa-check ml-2"></i>
                    </button>
                </div>
                
            </form>
        </div>

        <!-- 结果分析 -->
        <div id="result-analysis" class="hidden bg-white rounded-2xl shadow-md p-6 md:p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fa fa-line-chart text-primary mr-3"></i> 你的学习情况分析
            </h2>
            
            <div id="loading-indicator" class="text-center py-10">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary mb-4"></div>
                <p class="text-gray-600">正在分析你的学习情况，请稍候...</p>
            </div>
            
            <div id="analysis-results" class="hidden">
                <!-- 优势分析 -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-green-600 mb-4 flex items-center">
                        <i class="fa fa-check-circle mr-2"></i> 你的学习优势
                    </h3>
                    <div id="strengths" class="bg-green-50 border-l-4 border-green-500 p-4 rounded-r-lg">
                        <!-- 优势内容将在这里显示 -->
                    </div>
                </div>
                
                <!-- 待改进 -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-orange-600 mb-4 flex items-center">
                        <i class="fa fa-exclamation-circle mr-2"></i> 可以改进的地方
                    </h3>
                    <div id="improvements" class="bg-orange-50 border-l-4 border-orange-500 p-4 rounded-r-lg">
                        <!-- 待改进内容将在这里显示 -->
                    </div>
                </div>
                
                <!-- 建议 -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-primary mb-4 flex items-center">
                        <i class="fa fa-lightbulb-o mr-2"></i> 个性化学习建议
                    </h3>
                    <div id="recommendations" class="bg-primary/5 border-l-4 border-primary p-4 rounded-r-lg">
                        <!-- 建议内容将在这里显示 -->
                    </div>
                </div>
                
                <div class="text-center mt-10">
                    <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
                        <button id="enter-learning-space" class="bg-secondary hover:bg-secondary/90 text-white font-medium py-3 px-8 rounded-full shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1">
                            进入学习空间 <i class="fa fa-graduation-cap ml-2"></i>
                        </button>
                        <button id="restart-survey" class="bg-gray-300 hover:bg-gray-400 text-gray-600 font-medium py-2 px-6 rounded-full shadow-sm hover:shadow-md transition-all duration-300 text-sm">
                            重新调查 <i class="fa fa-refresh ml-1"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


        <script>
document.addEventListener('DOMContentLoaded', function() {
    const learningQuestionMap = {
        q1: "不用老师或家长提醒，我也会主动学自己感兴趣的知识点",
        q2: "上课学到新内容时，我会觉得'哇，这个好有趣'",
        q3: "就算没有奖励，我也愿意花时间研究不懂的问题",
        q4: "我学习主要是为了得到老师或爸妈的表扬",
        q5: "看到同学成绩比我好时，我会想'我也要努力赶上'",
        q6: "我会用笔记、思维导图或小口诀帮助自己记知识点",
        q7: "上完课后，我会花时间复习当天学的内容",
        q8: "每天我会留固定的时间用来写作业和学习",
        q9: "写作业时，我能专心做事，不容易被手机或电视分心",
        q10: "即使作业很多，我也觉得自己能按时完成"
    };

    // 页面元素（原始逻辑完全保留）
    const welcomeScreen = document.getElementById('welcome-screen');
    const learningSurvey = document.getElementById('learning-survey');
    const hobbySurvey = document.getElementById('hobby-survey');
    const resultScreen = document.getElementById('result-analysis');
    
    // 进度指示器（原始逻辑完全保留）
    const step1Indicator = document.getElementById('step1-indicator');
    const step2Indicator = document.getElementById('step2-indicator');
    const step3Indicator = document.getElementById('step3-indicator');
    const progress12 = document.getElementById('progress-1-2');
    const progress23 = document.getElementById('progress-2-3');
    
    // 按钮（原始逻辑完全保留）
    const startBtn = document.getElementById('start-survey');
    const toHobbyBtn = document.getElementById('to-hobby-survey');
    const backToLearningBtn = document.getElementById('back-to-learning');
    const submitSurveyBtn = document.getElementById('submit-survey');
    const restartBtn = document.getElementById('restart-survey');
    
    // 欢迎页 → 学习问卷（原始跳转逻辑完全保留）
    startBtn?.addEventListener('click', function() {
        welcomeScreen.classList.add('hidden');
        learningSurvey.classList.remove('hidden');
        step1Indicator.classList.replace('bg-gray-300', 'bg-primary');
        step1Indicator.classList.replace('text-gray-600', 'text-white');
    });
    
    // 学习问卷 → 爱好问卷（原始跳转逻辑完全保留）
    toHobbyBtn?.addEventListener('click', function() {
        if (!validateLearningSurvey()) {
            alert('请完成学习情况的所有问题后再继续哦！');
            return;
        }
        learningSurvey.classList.add('hidden');
        hobbySurvey.classList.remove('hidden');
        step2Indicator.classList.replace('bg-gray-300', 'bg-primary');
        step2Indicator.classList.replace('text-gray-600', 'text-white');
        progress12.style.width = '100%';
    });
    
    // 爱好问卷 → 学习问卷（原始回退逻辑完全保留）
    backToLearningBtn?.addEventListener('click', function() {
        hobbySurvey.classList.add('hidden');
        learningSurvey.classList.remove('hidden');
    });
    
    // 爱好问卷 → 结果页（原始提交逻辑完全保留，仅内部调用API部分优化解析）
    submitSurveyBtn?.addEventListener('click', async function() {
        if (!validateHobbySurvey()) {
            alert('请完成数学学习爱好的所有问题后再提交哦！');
            return;
        }
        hobbySurvey.classList.add('hidden');
        resultScreen.classList.remove('hidden');
        step3Indicator.classList.replace('bg-gray-300', 'bg-primary');
        step3Indicator.classList.replace('text-gray-600', 'text-white');
        progress23.style.width = '100%';
        
        try {
            const formData = collectSurveyData();
            await callCozeAPI(formData); // 仅优化此函数内的解析逻辑
        } catch (error) {
            console.error('API调用失败:', error);
            const loading = document.getElementById('loading-indicator');
            if (loading) {
                loading.innerHTML = `
                    <i class="fa fa-exclamation-circle text-red-500 text-3xl mb-4"></i>
                    <p class="text-red-600">分析失败：${error.message}</p>
                    <p class="text-gray-500 text-sm mt-2">请稍后重试</p>
                `;
            }
        }
    });

    // 进入学习空间按钮
    const enterLearningSpaceBtn = document.getElementById('enter-learning-space');
    enterLearningSpaceBtn?.addEventListener('click', function() {
        // 跳转到学习空间首页
        window.location.href = 'home.html';
    });

    // 结果页 → 欢迎页（原始重置逻辑完全保留）
    restartBtn?.addEventListener('click', function() {
        resultScreen.classList.add('hidden');
        welcomeScreen.classList.remove('hidden');
        step1Indicator.classList.replace('bg-primary', 'bg-gray-300');
        step1Indicator.classList.replace('text-white', 'text-gray-600');
        step2Indicator.classList.replace('bg-primary', 'bg-gray-300');
        step2Indicator.classList.replace('text-white', 'text-gray-600');
        step3Indicator.classList.replace('bg-primary', 'bg-gray-300');
        step3Indicator.classList.replace('text-white', 'text-gray-600');
        progress12.style.width = '0%';
        progress23.style.width = '0%';
    });
    
    // 验证学习问卷（原始逻辑完全保留）
    function validateLearningSurvey() {
        const form = document.getElementById('learning-form');
        if (!form) return false;
        
        const groups = new Set();
        form.querySelectorAll('input[type="radio"]').forEach(radio => groups.add(radio.name));
        for (const name of groups) {
            if (!form.querySelector(`input[name="${name}"]:checked`)) {
                return false;
            }
        }
        return true;
    }
    
    // 验证爱好问卷（原始逻辑完全保留）
    function validateHobbySurvey() {
        const form = document.getElementById('hobby-form');
        if (!form) return false;
        
        const radioGroups = new Set();
        form.querySelectorAll('input[type="radio"]').forEach(radio => radioGroups.add(radio.name));
        for (const name of radioGroups) {
            if (!form.querySelector(`input[name="${name}"]:checked`)) {
                return false;
            }
        }
        
        const mathAreas = form.querySelectorAll('input[name="math-areas"]:checked').length > 0;
        const mathPractices = form.querySelectorAll('input[name="math-practices"]:checked').length > 0;
        return mathAreas && mathPractices;
    }
    
    // 收集问卷数据（原始逻辑完全保留）
    function collectSurveyData() {
        return {
            learningData: collectLearningData(),
            hobbyData: collectHobbyData()
        };
    }
    
    // 收集学习数据（原始逻辑完全保留）
    function collectLearningData() {
        const form = document.getElementById('learning-form');
        if (!form) return [];
        
        const data = [];
        form.querySelectorAll('.question').forEach(questionEl => {
            const radioName = questionEl.querySelector('input[type="radio"]')?.name;
            const questionText = learningQuestionMap[radioName] || '未知问题';
            const checkedRadio = questionEl.querySelector('input[type="radio"]:checked');
            
            if (radioName && checkedRadio) {
                data.push({
                    question: questionText,
                    key: radioName,
                    answer: {
                        value: checkedRadio.value,
                        text: checkedRadio.parentElement.textContent.trim()
                    }
                });
            }
        });
        return data;
    }
    
    // 收集爱好数据（原始逻辑完全保留）
    function collectHobbyData() {
        const form = document.getElementById('hobby-form');
        if (!form) return {};
        
        const data = {
            mathAreas: [],
            learningStyle: {},
            efficientWay: {},
            difficultyHandle: {},
            mathPractices: [],
            wish: ""
        };
        
        form.querySelectorAll('input[name="math-areas"]:checked').forEach(cb => {
            data.mathAreas.push(cb.value);
        });
        
        const learningStyle = form.querySelector('input[name="learning-style"]:checked');
        if (learningStyle) {
            data.learningStyle = {
                value: learningStyle.value,
                text: learningStyle.parentElement.textContent.trim()
            };
        }
        
        const efficientWay = form.querySelector('input[name="efficient-way"]:checked');
        if (efficientWay) {
            data.efficientWay = {
                value: efficientWay.value,
                text: efficientWay.parentElement.textContent.trim()
            };
        }
        
        const difficultyHandle = form.querySelector('input[name="difficulty-handle"]:checked');
        if (difficultyHandle) {
            data.difficultyHandle = {
                value: difficultyHandle.value,
                text: difficultyHandle.parentElement.textContent.trim()
            };
        }
        
        form.querySelectorAll('input[name="math-practices"]:checked').forEach(cb => {
            data.mathPractices.push(cb.value);
        });
        
        const wish = form.querySelector('textarea[name="wish"]');
        if (wish) {
            data.wish = wish.value.trim();
        }
        
        return data;
    }
    
    // 【仅优化此函数内的解析逻辑】：正确提取currentData中的content并填充三个板块
    async function callCozeAPI(formData) {
        const WORKFLOW_ID = "7551642531362127881";
        const APP_ID = "7551596535822958646";
        const PAT = "pat_Z6Rslhq4RGEvDyxSGcRjxIhk2aCsXVerWCHrHpqd95qhQXG42lnzb3L8t3tVFLjl";

        // 原始请求参数构造完全保留
        const requestData = {
            workflow_id: WORKFLOW_ID,
            app_id: APP_ID,
            inputs: {
                collectLearningData: JSON.stringify(formData.learningData, null, 2),
                collectHobbyData: JSON.stringify(formData.hobbyData, null, 2)
            },
            parameters: {
                user_id: "student_" + Date.now(),
                survey_type: "math_learning_survey",
                submit_time: new Date().toISOString()
            }
        };

        console.log('API请求参数：', requestData);
        const response = await fetch('https://api.coze.cn/v1/workflow/stream_run', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${PAT}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestData)
        });

        if (!response.ok) {
            throw new Error(`API错误：状态码${response.status}`);
        }

 // 【核心优化点】：正确解析SSE中的currentData.content
 const reader = response.body.getReader();
const decoder = new TextDecoder();
let doneContent = ''; // 存储最终要解析的content（从Message/Done事件提取）
const loadingEl = document.getElementById('loading-indicator');
const resultEl = document.getElementById('analysis-results');
let incompleteChunk = '';

while (true) {
    const { done, value } = await reader.read();
    if (done) {
        // 流结束后，解析content并填充到页面
        if (doneContent) {
            try {
                console.log('🔍 【最终解析前】doneContent 原始值：', doneContent);
                // 处理转义字符（还原\"为"、\\\\为\）
                const unescapedContent = doneContent.replace(/\\"/g, '"').replace(/\\\\/g, '\\');
                console.log('🔍 【转义处理后】unescapedContent：', unescapedContent);
                // 解析为JSON对象
                let parsedContent = JSON.parse(unescapedContent);
                console.log('🔍 【JSON解析后】parsedContent：', parsedContent);

                // 提取三个核心字段（带兜底默认值）
                const strengths = parsedContent.strengths || '暂无学习优势分析';
                const improvements = parsedContent.improvements || '暂无改进建议';
                const recommendations = parsedContent.recommendations || '暂无学习建议';
                console.log('🔍 提取结果：strengths=%s, improvements=%s, recommendations=%s', strengths, improvements, recommendations);

                // 处理换行：将\n替换为<br>（让HTML解析换行）
                const strengthsWithBr = strengths.replace(/\n/g, '<br>');
                const improvementsWithBr = improvements.replace(/\n/g, '<br>');
                const recommendationsWithBr = recommendations.replace(/\n/g, '<br>');

                // 填充到页面（用innerHTML解析<br>标签）
                const strengthsEl = document.getElementById('strengths');
                const improvementsEl = document.getElementById('improvements');
                const recommendationsEl = document.getElementById('recommendations');
                if (strengthsEl) strengthsEl.innerHTML = strengthsWithBr;
                if (improvementsEl) improvementsEl.innerHTML = improvementsWithBr;
                if (recommendationsEl) recommendationsEl.innerHTML = recommendationsWithBr;

                loadingEl?.classList.add('hidden');
                resultEl?.classList.remove('hidden');
            } catch (parseErr) {
                console.error('❌ 解析content失败：', parseErr);
                resultEl?.classList.remove('hidden');
                resultEl.innerHTML = '分析结果解析失败，请联系管理员';
            }
        }
        break;
    }

    // 处理SSE分片（拼接不完整的行）
    let chunk = decoder.decode(value, { stream: true });
    console.log('🔍 【当前分片】chunk内容：', chunk);
    if (incompleteChunk) {
        chunk = incompleteChunk + chunk;
        incompleteChunk = '';
        console.log('🔍 【拼接后】chunk内容：', chunk);
    }

    const lines = chunk.split('\n');
    console.log('🔍 【分割后】lines：', lines);
    if (!chunk.endsWith('\n') && lines.length > 0) {
        incompleteChunk = lines.pop() || '';
        console.log('🔍 【暂存】incompleteChunk：', incompleteChunk);
    }

    let currentEvent = null;
    let currentData = '';
    for (const line of lines) {
        const trimmed = line.trim();
        if (!trimmed) continue;

        // 解析event类型
        if (trimmed.startsWith('event:')) {
            currentEvent = trimmed.substring('event:'.length).trim();
            console.log('🔍 【事件类型】currentEvent：', currentEvent);
            continue;
        }

        // 解析data内容
        if (trimmed.startsWith('data:')) {
            currentData = trimmed.substring('data:'.length).trim();
            console.log('🔍 【数据内容】currentData：', currentData);
            
            // 根据事件类型提取content
            if (currentEvent === 'Message') {
                try {
                    const messageData = JSON.parse(currentData);
                    if (messageData.content) {
                        doneContent = messageData.content; // 从Message事件提取content
                        console.log('🔍 【从Message提取】doneContent：', doneContent);
                    }
                } catch (err) {
                    console.error('❌ 解析Message事件data失败：', err);
                }
            } else if (currentEvent === 'Done') {
                try {
                    const doneData = JSON.parse(currentData);
                    console.log('🔍 【Done事件数据】doneData：', doneData);
                    // 若Done事件包含content，补充提取（按需调整）
                    if (doneData.content) {
                        doneContent = doneData.content;
                    }
                } catch (err) {
                    console.error('❌ 解析Done事件data失败：', err);
                }
            } else if (currentEvent === 'Error') {
                throw new Error(`❌ 工作流错误：${currentData}`);
            }

            currentEvent = null;
            currentData = '';
        }
    }
}
        // 原始兜底逻辑保留
        if (incompleteChunk && !doneContent) {
            try {
                const data = JSON.parse(incompleteChunk);
                doneContent = data.content || data.data?.content || '{}';
            } catch (residualErr) {
                console.error('处理剩余数据失败：', residualErr);
            }
        }
    }
});
        </script>

</body>
</html>